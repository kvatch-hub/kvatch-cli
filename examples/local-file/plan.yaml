name: localfile_example 

storage:
  type: sqlite
  data_store_path: localfile_example.db

# CONNECTORS: Define where and how to access data (connections)
connectors:
  - name: employees
    type: localfile
    connection:
      file_path: "./data/employees.json"
    desc: "JSON file with my employee data"

  - name: projects
    type: localfile
    connection:
      file_path: "./data/projects.json"
    desc: "JSON file with my project data"

# DATASETS: Define how to process and translate data (plugins)
datasets:
  - name: all_employees
    connector_name: employees
    type: json
    options:
      query: "SELECT * FROM data"
      timeout: 30

      dedupe:
        - id

  - name: all_projects
    connector_name: projects
    type: json
    # query: "SELECT * FROM projects"

    options:
      query: "SELECT * FROM projects"
      timeout: 30

      dedupe:
        - project_id

  - name: employee_projects
    connector_name: federated
    type: sql
    
    options:
      query: |
        SELECT e.name as employee_name, e.department, e.salary,
              p.name as project_name, p.budget
        FROM all_employees e
        JOIN all_projects p ON e.id = p.owner_id

      timeout: 30
    
    children:
      - dataset_name: all_employees
      - dataset_name: all_projects

  # Copy of the projects file in JSON
  # - name: all_projects
  #   connector_name: projects
  #   type: JSON
  #   query: "SELECT * FROM projects"
  #  options:
  #     timeout: 30
  #   dedupe:
  #    - project_id

output:
  dataset_name: employee_projects
  verbose: true