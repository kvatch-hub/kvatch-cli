name: local_files_example 

storage:
  type: sqlite
  data_store_path: local_file_example.db

# CONNECTORS: Define where and how to access data (connections)
connectors:
  - name: employees
    type: LOCAL_FILE
    connection:
      file_path: "./data/employees.json"
    desc: "JSON file with my employee data"
  - name: projects
    type: LOCAL_FILE
    connection:
      file_path: "./data/projects.json"
    desc: "JSON file with my project data"

# DATASETS: Define how to process and translate data (plugins)
datasets:
  - name: all_employees
    connector_name: employees
    type: JSON
    query: "SELECT * FROM data"
    config:
      timeout: 30
    dedupe_key:
     - id

  - name: all_projects
    connector_name: projects
    type: YAML
    query: "SELECT * FROM projects"
    config:
      timeout: 30
    dedupe_key:
     - project_id

# Copy of the projects file in JSON
  # - name: all_projects
  #   connector_name: projects
  #   type: JSON
  #   query: "SELECT * FROM projects"
  #   config:
  #     timeout: 30
  #   dedupe_key:
  #    - project_id

  - name: employee_projects
    connector_name: federated
    type: SQL
    query: |
      SELECT e.name as employee_name, e.department, e.salary,
            p.name as project_name, p.budget
      FROM all_employees e
      JOIN all_projects p ON e.id = p.owner_id
    config:
      timeout: 30
    children:
      - dataset_name: all_employees
      - dataset_name: all_projects

output:
  dataset_name: employee_projects