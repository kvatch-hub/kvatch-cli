name: quickstart

storage:
  type: sqlite
  data_store_path: quickstart.db

connectors:
  - name: issuers
    type: localfile
    connection:
      file_path: "./data/issuers.csv"
    desc: "CSV file with issuer data"

  - name: payments
    type: localfile
    connection:
      file_path: "./data/payments.json"
    desc: "JSON file with payment records"

datasets:
  - name: issuer_data
    connector_name: issuers
    type: csv

    options:
      timeout: 30
      has_headers: true

      dedupe:
        - bin

  - name: payment_data
    connector_name: payments
    type: json

    options:
      query: "SELECT * FROM payments"
      timeout: 30

      flatten_nested_objects: true
      normalize_nested_objects: true

  - name: joined_payments
    connector_name: federated
    type: sql

    options:
      query: |
        SELECT 
          p.payment_id, p.amount, p.currency, p.timestamp,
          p.bin,
          i.scheme, i.brand, i.card_type, i.country, i.bank_name
        FROM payment_data p
        LEFT JOIN issuer_data i ON p.bin = i.bin
  
      timeout: 30

    children:
      - dataset_name: issuer_data
      - dataset_name: payment_data

output:
  dataset_name: joined_payments
  verbose: true